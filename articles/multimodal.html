<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Example on Real Multi-modal Medical Data • Survinng</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example on Real Multi-modal Medical Data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Survinng</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/how_to_load_model.html">How to load my model?</a></li>
    <li><a class="dropdown-item" href="../articles/multimodal.html">Example on Real Multi-modal Medical Data</a></li>
    <li><a class="dropdown-item" href="../articles/Sim_time_dependent.html">Simulation of Time-dependent Effects</a></li>
    <li><a class="dropdown-item" href="../articles/Sim_time_independent.html">Simulation of Time-independent Effects</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Example on Real Multi-modal Medical Data</h1>
            
      

      <div class="d-none name"><code>multimodal.Rmd</code></div>
    </div>

    
    
<p>This vignette demonstrates how to apply gradient-based attribution
methods to a multi-modal survival model trained on real medical data.
Specifically, we explore the interpretability of a DeepHit-style neural
network that jointly processes tabular and image-based features. The
model is evaluated on a set of test instances and visualized using
various attribution techniques.</p>
<p><strong>Note:</strong> Since the images used in this example are of
size <code>(3, 226, 226)</code>, running this example may take a while
or too much memory, especially for the <code>GradSHAP(t)</code> and
<code>IntGrad(t)</code> methods if too many samples are used. To avoid
this, we recommend using smaller sample sizes or number of integration
points.</p>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>We begin by loading the necessary libraries and setting the seeds to
ensure reproducibility. The helper functions used for image processing
and visualization are sourced from a separate utility script which can
be found in the <code>vignettes/articles/real_data</code> directory or
online <a href="https://github.com/bips-hb/Survinng/blob/2640cffaba38e81d6b6f2ee3051b2d9f44d0f86f/vignettes/articles/real_data/utils.R" class="external-link">in
the GitHub repository</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bips-hb.github.io/Survinng/">Survinng</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://torch.mlverse.org/docs" class="external-link">torch</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://torchvision.mlverse.org" class="external-link">torchvision</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:data.table':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     between, first, last</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:Survinng':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     explain</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; here() starts at /home/runner/work/Survinng/Survinng</span></span>
<span></span>
<span><span class="co"># Load helper functions</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"vignettes/articles/real_data/utils.R"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set seeds for reproducibility</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://torch.mlverse.org/docs/reference/torch_manual_seed.html" class="external-link">torch_manual_seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="load-model-and-metadata">Load model and metadata<a class="anchor" aria-label="anchor" href="#load-model-and-metadata"></a>
</h2>
<p>We first load the trained model along with its corresponding
metadata, including the number of outputs for the image and joint
components, whether a bias term was included, and the number of tabular
features. The model’s performance is briefly summarized using two
commonly used survival metrics: the Concordance index and the Integrated
Brier Score.</p>
<p>After restoring the model’s state dictionary, we replicate the
multi-modal network structure consisting of a ResNet34 backbone for the
image branch and a linear transformation for the tabular input.</p>
<p>All required files are available in the
<code>vignettes/articles/real_data</code> directory or online <a href="https://github.com/bips-hb/Survinng/tree/2640cffaba38e81d6b6f2ee3051b2d9f44d0f86f/vignettes/articles/real_data" class="external-link">in
the GitHub repository folder</a>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load model metadata</span></span>
<span><span class="va">model_metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"vignettes/articles/real_data/metadata.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">n_img_out</span> <span class="op">&lt;-</span> <span class="va">model_metadata</span><span class="op">$</span><span class="va">n_img_out</span></span>
<span><span class="va">n_out</span> <span class="op">&lt;-</span> <span class="va">model_metadata</span><span class="op">$</span><span class="va">n_out</span></span>
<span><span class="va">out_bias</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="va">model_metadata</span><span class="op">$</span><span class="va">out_bias</span><span class="op">)</span></span>
<span><span class="va">n_tab_feat</span> <span class="op">&lt;-</span> <span class="va">model_metadata</span><span class="op">$</span><span class="va">Number.of.tabular.features</span></span>
<span></span>
<span><span class="co"># Show performance results</span></span>
<span><span class="va">model_metadata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Concordance"</span>, <span class="st">"Integrated.Brier.score"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;   Concordance Integrated.Brier.score</span></span>
<span><span class="co">#&gt; 1   0.7133996              0.0919935</span></span>
<span></span>
<span><span class="co"># Load model state dict</span></span>
<span><span class="va">model_state_dict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/load_state_dict.html" class="external-link">load_state_dict</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"vignettes/articles/real_data/model.pt"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Replicate model</span></span>
<span><span class="va">net_image</span> <span class="op">&lt;-</span> <span class="fu">torchvision</span><span class="fu">::</span><span class="fu"><a href="https://torchvision.mlverse.org/reference/model_resnet.html" class="external-link">model_resnet34</a></span><span class="op">(</span>num_classes <span class="op">=</span> <span class="va">n_img_out</span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu">MultiModalModel</span><span class="op">(</span><span class="va">net_image</span>, tabular_features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n_tab_feat</span><span class="op">)</span>,</span>
<span>                         n_out <span class="op">=</span> <span class="va">n_out</span>, n_img_out <span class="op">=</span> <span class="va">n_img_out</span>, out_bias <span class="op">=</span> <span class="va">out_bias</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load model state dict</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="fu">load_state_dict</span><span class="op">(</span><span class="va">model_state_dict</span><span class="op">)</span></span>
<span><span class="va">model</span><span class="op">$</span><span class="fu">eval</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">model</span></span>
<span><span class="co">#&gt; An `nn_module` containing 21,518,292 parameters.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Modules ─────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; • net_images: &lt;resnet&gt; #21,416,000 parameters</span></span>
<span><span class="co">#&gt; • fc1: &lt;nn_linear&gt; #66,816 parameters</span></span>
<span><span class="co">#&gt; • fc2: &lt;nn_linear&gt; #32,896 parameters</span></span>
<span><span class="co">#&gt; • relu: &lt;nn_relu&gt; #0 parameters</span></span>
<span><span class="co">#&gt; • drop_0_3: &lt;nn_dropout&gt; #0 parameters</span></span>
<span><span class="co">#&gt; • drop_0_4: &lt;nn_dropout&gt; #0 parameters</span></span>
<span><span class="co">#&gt; • out: &lt;nn_linear&gt; #2,580 parameters</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="load-data">Load data<a class="anchor" aria-label="anchor" href="#load-data"></a>
</h2>
<p>Next, we prepare the input data for evaluation and explanation. This
includes:</p>
<ul>
<li>A tabular dataset containing numeric predictors.</li>
<li>Corresponding image files from the test set.</li>
</ul>
<p>Images are preprocessed using standard transformations (center
cropping and normalization) and stacked into a single tensor. The
tabular inputs are converted into a Torch tensor to be compatible with
the model input format.</p>
<p><strong>Note:</strong> The tabular and image data can be found in the
<code>vignettes/articles/real_data</code> directory or online in the <a href="https://github.com/bips-hb/Survinng/tree/2640cffaba38e81d6b6f2ee3051b2d9f44d0f86f/vignettes/articles/real_data" class="external-link">GitHub
repository folder</a>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"vignettes/articles/real_data/deephit_tabular_data.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">test_images</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"vignettes/articles/real_data/test"</span><span class="op">)</span>, full.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter data</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">full_path</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">test_images</span>, <span class="op">]</span></span>
<span><span class="va">data_tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/torch_tensor.html" class="external-link">torch_tensor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">data_img</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torch.mlverse.org/docs/reference/torch_stack.html" class="external-link">torch_stack</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">full_path</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://torchvision.mlverse.org/reference/base_loader.html" class="external-link">base_loader</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"vignettes/articles/real_data/test/"</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span>,,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://torchvision.mlverse.org/reference/transform_to_tensor.html" class="external-link">transform_to_tensor</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://torchvision.mlverse.org/reference/transform_center_crop.html" class="external-link">transform_center_crop</a></span><span class="op">(</span><span class="fl">226</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://torchvision.mlverse.org/reference/transform_normalize.html" class="external-link">transform_normalize</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.485</span>, <span class="fl">0.456</span>, <span class="fl">0.406</span><span class="op">)</span>, std <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.229</span>, <span class="fl">0.224</span>, <span class="fl">0.225</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span>, dim <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="explain-model">Explain model<a class="anchor" aria-label="anchor" href="#explain-model"></a>
</h2>
<p>We apply several gradient-based feature attribution techniques
adapted for survival analysis to explain the model’s prediction of a
selected test instance:</p>
<ul>
<li><p>Grad(t): Simple backpropagation-based gradients with respect to
the input.</p></li>
<li><p>SG(t): A noise-averaged version of gradients to improve local
fluctuations of the gradients.</p></li>
<li><p>IG(t): A path-based method that accumulates gradients along a
linear interpolation between a baseline and the input. In this example,
we use a mean baseline.</p></li>
<li><p>GradSHAP(t): An approximation to SHAP values using randomized
baseline samples combined with gradient integration.</p></li>
</ul>
<p>Each method runs with a moderate batch size of 10 and a fixed number
of samples to ensure computational feasibility. For better estimates, we
recommend using larger sample sizes or number of integration points, but
this may lead to increased memory usage and longer computation times.
The explanations are stored in data.tables for downstream
visualization.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exp_deephit</span> <span class="op">&lt;-</span> <span class="fu">Survinng</span><span class="fu">::</span><span class="fu"><a href="../reference/explain.html">explain</a></span><span class="op">(</span><span class="va">model</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">data_img</span>, <span class="va">data_tab</span><span class="op">)</span>, </span>
<span>                                 model_type <span class="op">=</span> <span class="st">"deephit"</span>,</span>
<span>                                 time_bins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">17</span>, length.out <span class="op">=</span> <span class="va">n_out</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ids</span> <span class="op">&lt;-</span> <span class="fl">230</span></span>
<span><span class="va">orig_img</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://torchvision.mlverse.org/reference/base_loader.html" class="external-link">base_loader</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"vignettes/articles/real_data/test/"</span>, <span class="va">data</span><span class="op">[</span><span class="va">ids</span>, <span class="op">]</span><span class="op">$</span><span class="va">full_path</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run Grad(t)</span></span>
<span><span class="va">grad</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/surv_grad.html">surv_grad</a></span><span class="op">(</span><span class="va">exp_deephit</span>, instance <span class="op">=</span> <span class="va">ids</span>, batch_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;           used (Mb) gc trigger  (Mb) max used  (Mb)</span></span>
<span><span class="co">#&gt; Ncells 1503811 80.4    2541664 135.8  2541664 135.8</span></span>
<span><span class="co">#&gt; Vcells 5779262 44.1   16380020 125.0 12084423  92.2</span></span>
<span></span>
<span><span class="co"># Run SG(t)</span></span>
<span><span class="va">sgrad</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/surv_smoothgrad.html">surv_smoothgrad</a></span><span class="op">(</span><span class="va">exp_deephit</span>, instance <span class="op">=</span> <span class="va">ids</span>, n <span class="op">=</span> <span class="fl">50</span>, </span>
<span>                         noise_level <span class="op">=</span> <span class="fl">0.3</span>, batch_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;           used (Mb) gc trigger  (Mb)  max used   (Mb)</span></span>
<span><span class="co">#&gt; Ncells 1506108 80.5    2541664 135.8   2541664  135.8</span></span>
<span><span class="co">#&gt; Vcells 8849584 67.6  124608412 950.7 132090721 1007.8</span></span>
<span></span>
<span><span class="co"># Run IntGrad(t)</span></span>
<span><span class="va">intgrad</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/surv_intgrad.html">surv_intgrad</a></span><span class="op">(</span><span class="va">exp_deephit</span>, instance <span class="op">=</span> <span class="va">ids</span>, n <span class="op">=</span> <span class="fl">50</span>, batch_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;            used (Mb) gc trigger  (Mb)  max used   (Mb)</span></span>
<span><span class="co">#&gt; Ncells  1508184 80.6    2541664 135.8   2541664  135.8</span></span>
<span><span class="co">#&gt; Vcells 11918807 91.0  127554189 973.2 132090721 1007.8</span></span>
<span></span>
<span><span class="co"># Run GradSHAP(t)</span></span>
<span><span class="va">grad_shap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/surv_gradSHAP.html">surv_gradSHAP</a></span><span class="op">(</span><span class="va">exp_deephit</span>, instance <span class="op">=</span> <span class="va">ids</span>, n <span class="op">=</span> <span class="fl">10</span>, num_samples <span class="op">=</span> <span class="fl">50</span>, </span>
<span>                           batch_size <span class="op">=</span> <span class="fl">10</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;            used  (Mb) gc trigger  (Mb)  max used   (Mb)</span></span>
<span><span class="co">#&gt; Ncells  1508803  80.6    2541664 135.8   2541664  135.8</span></span>
<span><span class="co">#&gt; Vcells 14985069 114.4   52246197 398.7 132090721 1007.8</span></span>
<span></span>
<span><span class="co"># Convert to data.tables</span></span>
<span><span class="va">grad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">grad</span><span class="op">)</span></span>
<span><span class="va">sgrad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">sgrad</span><span class="op">)</span></span>
<span><span class="va">intgrad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">intgrad</span><span class="op">)</span></span>
<span><span class="va">grad_shap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">grad_shap</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualize-results">Visualize results<a class="anchor" aria-label="anchor" href="#visualize-results"></a>
</h2>
<p>For each method, we visualize:</p>
<ul>
<li>The original image.</li>
<li>The pixel-wise relevance heatmap.</li>
<li>A combined view aligning tabular and image attributions.</li>
</ul>
<p>The plots enable a comparative interpretation of how each attribution
method highlights relevant regions in the image and important features
in the tabular input over time. In particular, the visualizations allow
us to examine the consistency and plausibility of attributions across
methods, offering insight into the internal reasoning of the survival
model.</p>
<div class="section level3">
<h3 id="plot-gradt">Plot Grad(t)<a class="anchor" aria-label="anchor" href="#plot-gradt"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu">plot_result</span><span class="op">(</span><span class="va">grad</span>, <span class="va">orig_img</span>, name <span class="op">=</span> <span class="st">"real_data_grad"</span>, as_force <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'id', 'time'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'id', 'time', 'height'. You can override</span></span>
<span><span class="co">#&gt; using the `.groups` argument.</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">ℹ</span> Google's Terms of Service: <span style="color: #0000BB; font-style: italic;">&lt;https://mapsplatform.google.com&gt;</span> Stadia Maps'</span></span>
<span><span class="co">#&gt; Terms of Service: <span style="color: #0000BB; font-style: italic;">&lt;https://stadiamaps.com/terms-of-service&gt;</span> OpenStreetMap's</span></span>
<span><span class="co">#&gt; Tile Usage Policy: <span style="color: #0000BB; font-style: italic;">&lt;https://operations.osmfoundation.org/policies/tiles&gt;</span> <span style="color: #00BB00;">ℹ</span></span></span>
<span><span class="co">#&gt; Please cite <span style="color: #0000BB;">ggmap</span> if you use it! Use `citation("ggmap")` for details.</span></span>
<span><span class="co">#&gt; Attaching package: 'ggmap'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:cowplot':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; theme_nothing</span></span>
<span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, </span>
<span>          <span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">plots</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, <span class="va">plots</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, nrow <span class="op">=</span> <span class="fl">1</span>, rel_widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.25</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="multimodal_files/figure-html/unnamed-chunk-5-1.png" width="1152"></p>
</div>
<div class="section level3">
<h3 id="plot-sgt">Plot SG(t)<a class="anchor" aria-label="anchor" href="#plot-sgt"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu">plot_result</span><span class="op">(</span><span class="va">sgrad</span>, <span class="va">orig_img</span>, name <span class="op">=</span> <span class="st">"real_data_sgrad"</span>, as_force <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'id', 'time'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'id', 'time', 'height'. You can override</span></span>
<span><span class="co">#&gt; using the `.groups` argument.</span></span>
<span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, </span>
<span>          <span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">plots</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, <span class="va">plots</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, nrow <span class="op">=</span> <span class="fl">1</span>, rel_widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.25</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="multimodal_files/figure-html/unnamed-chunk-6-1.png" width="1152"></p>
</div>
<div class="section level3">
<h3 id="plot-intgradt">Plot IntGrad(t)<a class="anchor" aria-label="anchor" href="#plot-intgradt"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu">plot_result</span><span class="op">(</span><span class="va">intgrad</span>, <span class="va">orig_img</span>, name <span class="op">=</span> <span class="st">"real_data_intgrad"</span>, as_force <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'id', 'time'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'id', 'time', 'height'. You can override</span></span>
<span><span class="co">#&gt; using the `.groups` argument.</span></span>
<span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, </span>
<span>          <span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">plots</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, <span class="va">plots</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, nrow <span class="op">=</span> <span class="fl">1</span>, rel_widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.25</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="multimodal_files/figure-html/unnamed-chunk-7-1.png" width="1152"></p>
</div>
<div class="section level3">
<h3 id="plot-gradshapt">Plot GradSHAP(t)<a class="anchor" aria-label="anchor" href="#plot-gradshapt"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu">plot_result</span><span class="op">(</span><span class="va">grad_shap</span>, <span class="va">orig_img</span>, name <span class="op">=</span> <span class="st">"real_data_gradshap"</span>, as_force <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'id', 'time'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'id', 'time', 'height'. You can override</span></span>
<span><span class="co">#&gt; using the `.groups` argument.</span></span>
<span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, </span>
<span>          <span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">plots</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, <span class="va">plots</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, nrow <span class="op">=</span> <span class="fl">1</span>, rel_widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span>,</span>
<span>          rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.25</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="multimodal_files/figure-html/unnamed-chunk-8-1.png" width="1152"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Niklas Koenen, Sophie Hanna Langbein.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
